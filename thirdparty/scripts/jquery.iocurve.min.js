!function(G){"use strict";var H=Math.PI/2;Math.PI;function J(t){return t?t%H?Math.cos(t):0:1}function K(t,a,e,n,i){n=(i-e)/(n-a);return n*t+(e-n*a)}G.fn.iocurve=function(a){return this.each(function(){var t={x:[0,255],y:[0,255],dx:1,y0:0,curvature:.3,className:"",css:{position:"relative",margin:"20px"},canvas:{height:"100%",fillStyle:"#fff",css:{display:"block",boxShadow:"0 0 3px #000"}},grid:{visible:!0,strokeStyle:"rgba(0, 0, 0, 0.2)"},anchor:{points:[[0,0],[255,255]],tagName:"a",className:"anchor",css:{position:"absolute",display:"block",width:18,height:18,borderRadius:"50%",border:"1px solid rgba(0, 0, 0, 0.5)",background:"rgba(255, 255, 255, 0.5)",boxSizing:"border-box",cursor:"move",transform:"translate(-50%, -50%)"}},bar:{visible:!0,fillStyle:{positive:"rgba(0, 100, 70, 0.2)",negative:"rgba(150, 30, 70, 0.2)"}},plot:{visible:!1,strokeStyle:"#f00"},histogram:{data:null,fillStyle:"#ddd"},controlPoint:{visible:!1,strokeStyle:"#00f"}};G.extend(!0,t,a),function(g){var r,o,f,y,a,e,c,u,d=G(this),v=G(document.createElement("div")),x=G(),n=document.createElement("canvas"),s=n.getContext("2d"),h=[],l=[],p=[],m=[],M=[],b=[],w=[],S=[],k=[];function i(t){if(!(1<t.which)){var r,s,a=G(t.target);if(a.closest(this).length){if(a.hasClass(g.anchor.className)){if((s=x.index(t.target))<0)return;r=x.eq(s)}else{var e=v.offset(),n=t.pageX-e.left,i=t.pageY-e.top;if(x.each(function(t){return parseFloat(this.style.left)<n&&void(s=t+1)}),!(s&&s<x.length))return;a=parseFloat(x[s-1].style.left),e=parseFloat(x[s].style.left);if((n=Math.min(Math.max(a,n),e))===a||n===e)return;i=Math.min(Math.max(i,0),c),r=Y(n,i).insertBefore(x.eq(s)),x=v.find("."+g.anchor.className),F(r,"new"),N(),z()}var h={x:t.pageX,y:t.pageY,left:parseFloat(r.css("left")),top:parseFloat(r.css("top"))};G(document).one("mouseup",l),G(document).on("mousemove",o),t.preventDefault()}}function l(){G(document).off("mousemove",o)}function o(t){var a=t.pageX-h.x,e=t.pageY-h.y,n=Math.min(Math.max(h.left+a,0),c),i=Math.min(Math.max(h.top+e,0),u);if(0===s)n=0;else if(s===x.length-1)n=c;else{var o=x[s-1],t=x[s+1],a=parseFloat(o.style.left),e=parseFloat(t.style.left),o=parseFloat(o.style.top),t=parseFloat(t.style.top),n=Math.min(Math.max(n,a),e);if(a=Math.abs(n-a),o=Math.abs(i-o),a+o<6||(e=Math.abs(n-e),t=Math.abs(i-t),e+t<6))return l(),F(r,"remove"),r.remove(),x=v.find("."+g.anchor.className),N(),void z()}r.css("left",n),r.css("top",i),r.data("p",I(n,i)),F(r,"move"),N(),z()}}function F(t,a){var e=t.data("p"),e={element:t[0],kind:a,x:e[0],y:e[1]};return d.trigger("anchor",[e]),this}function N(){return d.trigger("anchors",[x]),this}function P(t,a){return a.call(this,p),!1}function R(t,a){return G.extend(!0,g,a),T(),C(),function(){for(var t=x.length;t--;){var a=x.eq(t),e=parseFloat(a.css("left")),n=parseFloat(a.css("top"));a.data("p",I(e,n))}}(),N(),z(),!1}function q(){return C(),x.each(function(){var t=G(this).data("p");G(this).css(j(t))}),N(),z(),!1}function T(){r=g.x[1]-g.x[0],o=g.y[1]-g.y[0],f=Math.floor(r/g.dx)+1,y=100*g.dx<r?g.dx/r:.01,G.each(g.canvas.css,function(t,a){n.style[t]=a}),v.addClass(g.className).css(g.css)}function C(){n.width=0,c=v.width()||d.width(),u=/%/.test(g.canvas.height)?c*parseFloat(g.canvas.height)/100:g.canvas.height,n.width=c*(window.devicePixelRatio||1),n.height=u*(window.devicePixelRatio||1),n.style.width=c+"px",n.style.height=u+"px",a=n.width/r,e=n.height/o,setTimeout(function(){v.width()<c-1&&q()},0)}function z(){!function(){var c=[],f=[],u=[],d=[],v=[],p=[],m=x.length-1,t=x.length<3||g.curvature<=0;h.length=l.length=0,b.length=w.length=0;for(var M=S.length=k.length=0;M<x.length;M++){var a=x.eq(M).data("p"),e=a[0],n=a[1],i=(e-g.x[0])/r,a=(n-g.y[0])/o;h[M]=e,l[M]=n,c[M]=i,f[M]=a,M&&(i=i-c[M-1],a=a-f[M-1],a=Math.sqrt(Math.pow(i,2)+Math.pow(a,2)),u[M-1]=a*g.curvature)}if(t)return E(c,f);for(M=1;M<m;M++)d[M]=function(t,a,e,n,i,o,r,s,h){if(r=Math.pow(e,2)+Math.pow(n,2),s=Math.pow(i,2)+Math.pow(o,2),r<s)return(h=r/s)*Math.atan2(a,t)+(1-h)*Math.atan2(n,e);if(s<r)return(h=s/r)*Math.atan2(a,t)+(1-h)*Math.atan2(o,i);return Math.atan2(a,t)}(c[M+1]-c[M-1],f[M+1]-f[M-1],c[M]-c[M-1],f[M]-f[M-1],c[M+1]-c[M],f[M+1]-f[M]),function(t,a,e,n,i,o){var r=a-J(o)*n,s=e-Math.sin(o)*n,h=a+J(o)*i,l=e+Math.sin(o)*i;(s<0||1<s)&&(r=Math.min(Math.max(r,0),1),s=Math.min(Math.max(s,0),1),o=d[t]=Math.atan2(e-s,a-r),h=a+J(o)*i,l=e+Math.sin(o)*i);(l<0||1<l)&&(h=Math.min(Math.max(h,0),1),l=Math.min(Math.max(l,0),1),o=d[t]=Math.atan2(l-e,h-a),r=a-J(o)*n,s=e-Math.sin(o)*n);b[t]=r,w[t]=s,S[t]=h,k[t]=l}(M,c[M],f[M],u[M-1],u[M],d[M]);(function(){var t,a,e,n,i=c[0],o=f[0],r=c[1],s=f[1],h=d[1];n=o===s?(l=(i+r)/2,l-=(e=r-J(h))-l,s-Math.sin(h)):(n=(o+s)/2-(i+r)/2*(t=(i-r)/(s-o)),a=2*Math.atan(t),t=Math.sin(a),l=(a=J(a))*(e=r-J(h))+t*(h=s-Math.sin(h)-n),t*e-a*h+n);var l=Math.atan2(n-o,l-i);(l<-H||H<l)&&(l=o<s?H:-H),d[0]=l;s=u[0],i+=J(l)*s,s=o+Math.sin(l)*s,i=Math.min(Math.max(i,0),1),s=Math.min(Math.max(s,0),1);S[0]=i,k[0]=s})(),function(){var t,a,e,n=c[m-1],i=f[m-1],o=d[m-1],r=c[m],s=f[m];l=i===s?(t=n+J(o),h=(n+r)/2,h+=h-t,i+Math.sin(o)):(l=(i+s)/2-(n+r)/2*(a=(n-r)/(s-i)),e=2*Math.atan(a),a=Math.sin(e),e=J(e),t=n+J(o),o=i+Math.sin(o)-l,h=e*t+a*o,a*t-e*o+l);var h=r-h,l=s-l,h=Math.atan2(l,h);(h<-H||H<h)&&(h=i<s?H:-H),d[m]=h;i=u[m-1],r-=J(h)*i,i=s-Math.sin(h)*i;r=Math.min(Math.max(r,0),1),i=Math.min(Math.max(i,0),1),b[m]=r,w[m]=i}(),v.push(c[0]),p.push(f[0]);for(M=0;M<m;M++)!function(a,e,n,i,o,r,s,h){s<o&&function(){var t=(a+n)/2;t<=s?(r=K(s,a,e,o,r)||r,o=s,S[M]=o,k[M]=r):(o<=t?(h=K(o,n,i,s,h)||h,s=o):(r=K(t,a,e,o,r)||r,h=K(t,n,i,s,h)||h,o=s=t,S[M]=o,k[M]=r),b[M+1]=s,w[M+1]=h)}();for(var t=Math.floor((n-a)/y),l=1;l<t;l++){var c=function(t,a,e,n,i,o,r,s,h){var l=1-h,c=h*h,f=l*l,u=c*h,d=f*l,h=3*f*h,c=3*l*c;return[d*t+h*i+c*r+u*e,d*a+h*o+c*s+u*n]}(a,e,n,i,o,r,s,h,l/t),f=Math.min(Math.max(c[0],0),1),c=Math.min(Math.max(c[1],0),1);v.push(f),p.push(c)}v.push(n),p.push(i)}(c[M],f[M],c[M+1],f[M+1],S[M],k[M],b[M+1],w[M+1]);E(v,p)}(),s.clearRect(0,0,n.width,n.height),s.fillStyle=g.canvas.fillStyle,s.fillRect(0,0,n.width,n.height),g.histogram.data&&function(){s.fillStyle=g.histogram.fillStyle;for(var t=s.canvas.width*g.dx/r,a=t/2,e=f;e--;){var n=m[e],i=(1-g.histogram.data[e])*s.canvas.height;s.fillRect(n-a,i,t,s.canvas.height-i)}}(),g.grid.visible&&(s.strokeStyle=g.grid.strokeStyle,X(n.width/2+.5,0,n.width/2+.5,n.height),X(0,n.height/2+.5,n.width,n.height/2+.5)),g.bar.visible&&function(){for(var t=s.canvas.width*g.dx/r,a=t/2,e=A(g.y0),n=f;n--;){var i=m[n],o=M[n];p[n]<0?(s.fillStyle=g.bar.fillStyle.negative,s.fillRect(i-a,e,t,o-e)):(s.fillStyle=g.bar.fillStyle.positive,s.fillRect(i-a,o,t,e-o))}}(),g.plot.visible&&function(){s.fillStyle=g.plot.strokeStyle;for(var t=f;t--;)s.fillRect(m[t]-2,M[t]-2,4,4)}(),g.controlPoint.visible&&b.length&&function(){s.strokeStyle=g.controlPoint.strokeStyle;for(var t=h.length-1;t--;)X(Q(h[t]),A(l[t]),Q(B(S[t])),A(D(k[t]))),X(Q(h[t+1]),A(l[t+1]),Q(B(b[t+1])),A(D(w[t+1])))}()}function E(a,e){var n,i,o=a.length-2,t=1/(f-1);c();for(var r=f;r--;){var s=r*t;if(s<a[o]){for(;s<a[o];)o--;c()}var h=n*s+i,l=B(s),h=D(h);m[r]=Q(l),M[r]=A(h),p[r]=h}function c(){var t=a[o+1]-a[o];if(t)return n=(e[o+1]-e[o])/t,void(i=e[o]-n*a[o]);n=0,i=e[o]}d.trigger("output",[p])}function X(t,a,e,n){s.beginPath(),s.moveTo(t,a),s.lineTo(e,n),s.stroke(),s.closePath()}function Y(t,a){var e=G(document.createElement(g.anchor.tagName));return e.addClass(g.anchor.className),e.css(g.anchor.css),e.css("left",t),e.css("top",a),e.data("p",I(t,a)),e}function I(t,a){return[g.x[0]+t*r/c,g.y[0]+(u-a)*o/u]}function j(t){return{left:(t[0]-g.x[0])*c/r,top:(o-(t[1]-g.y[0]))*u/o}}function B(t){return t*r+g.x[0]}function D(t){return t*o+g.y[0]}function Q(t){return(t-g.x[0])*a}function A(t){return(g.y[1]-t)*e}v.append(n).appendTo(d),d.on("mousedown",i),d.on("data",P),d.on("option",R),d.on("resized",q),d.on("destroy",function t(){d.off("mousedown",i),d.off("data",P),d.off("option",R),d.off("resized",q),d.off("destroy",t),v.remove(),x=G(),N()}),T(),C(),function(){for(var t=g.anchor.points,a=0;a<t.length;a++){var e=j(t[a]),e=Y(e.left,e.top);x=x.add(e)}x.appendTo(v)}(),N(),z()}.call(this,t)}),this}}(jQuery);
